schema: '2.0'
stages:
  etl_pipeline_full:
    cmd: python src/data_handling/etl_pipeline.py
    deps:
    - path: src/_utils/
      hash: md5
      md5: ae41392532188d290395495f6827ed00.dir
      size: 15870
      nfiles: 10
    - path: src/data_handling/
      hash: md5
      md5: 27dec72cc84da0ff6ff5b45bc9d9a86c.dir
      size: 95629
      nfiles: 30
    - path: src/data_handling/etl_pipeline.py
      hash: md5
      md5: 61fc8b195955c6e0cafb66ae19e69945
      size: 1733
    outs:
    - path: data/original_df.parquet
      hash: md5
      md5: 4775ce10ddb7704a354942d02fd7fcce
      size: 3628798
    - path: data/processed_df.parquet
      hash: md5
      md5: 5605f2648e91221d258d52380e0aa83b
      size: 7019782
  etl_pipeline_stockcode:
    cmd: python src/data_handling/etl_pipeline.py --stockcode 85123A
    deps:
    - path: src/_utils/
      hash: md5
      md5: ae41392532188d290395495f6827ed00.dir
      size: 15870
      nfiles: 10
    - path: src/data_handling/
      hash: md5
      md5: 27dec72cc84da0ff6ff5b45bc9d9a86c.dir
      size: 95629
      nfiles: 30
    - path: src/data_handling/etl_pipeline.py
      hash: md5
      md5: 61fc8b195955c6e0cafb66ae19e69945
      size: 1733
    params:
      params.yaml:
        params.stockcode: 85123A
    outs:
    - path: data/processed_df_85123A.parquet
      hash: md5
      md5: af5ca7ad77f7b1b64cde94fc768b0b9c
      size: 54966
  data_drift_check:
    cmd: "python src/data_handling/report_data_drift.py data/processed/processed_df.csv
      data/processed_df_85123A.parquet reports/data_drift_report_85123A.html metrics/data_drift_85123A.json
      85123A\n"
    deps:
    - path: src/_utils/
      hash: md5
      md5: ae41392532188d290395495f6827ed00.dir
      size: 15870
      nfiles: 10
    - path: src/data_handling/report_data_drift.py
      hash: md5
      md5: 16b2c1a87b4550da1927f23d91cc5331
      size: 3001
    - path: src/data_handling/scripts/
      hash: md5
      md5: fd102c3acff804257601173c7f465c8a.dir
      size: 50886
      nfiles: 16
    params:
      params.yaml:
        params.stockcode: 85123A
    outs:
    - path: metrics/data_drift_85123A.json
      hash: md5
      md5: d3ab7677e00c110f7a277f8584cb9b0d
      size: 606
    - path: reports/data_drift_report_85123A.html
      hash: md5
      md5: 6e1476ad1a6c396c3c8eb400f32f4d98
      size: 4557812
  preprocess_full:
    cmd: "python src/data_handling/preprocess.py --target_col quantity --should_scale
      true --verbose false\n"
    deps:
    - path: src/_utils
      hash: md5
      md5: ae41392532188d290395495f6827ed00.dir
      size: 15870
      nfiles: 10
    - path: src/data_handling/
      hash: md5
      md5: 27dec72cc84da0ff6ff5b45bc9d9a86c.dir
      size: 95629
      nfiles: 30
    - path: src/data_handling/preprocess.py
      hash: md5
      md5: 92c0850d9e030c3c7313fec8e0a1a550
      size: 6849
    params:
      params.yaml:
        params.should_scale: true
        params.target_col: quantity
        params.verbose: false
    outs:
    - path: data/x_test_df.parquet
      hash: md5
      md5: 01da54f6b6b37e7827cce3ac28797727
      size: 638272
    - path: data/x_test_processed.parquet
      hash: md5
      md5: f6c5ec0a4d7ac8a9f7ae7345111c4327
      size: 655361
    - path: data/x_train_df.parquet
      hash: md5
      md5: 21b49b634fcd6b012386fbe08e4da376
      size: 5312507
    - path: data/x_train_processed.parquet
      hash: md5
      md5: b84d4f821af05e182df7a83ea0a436d6
      size: 5403755
    - path: data/x_val_df.parquet
      hash: md5
      md5: 1c2a2fc23cd963c0c9e2fc6c5f254a34
      size: 589368
    - path: data/x_val_processed.parquet
      hash: md5
      md5: 6e68881d8e1d9cab789694490495d23a
      size: 605827
    - path: data/y_test_df.parquet
      hash: md5
      md5: 4ca500e54909a26840f31633e6ec636c
      size: 37845
    - path: data/y_train_df.parquet
      hash: md5
      md5: 9f55b7572e68b267e3bd52ae795ee727
      size: 380269
    - path: data/y_val_df.parquet
      hash: md5
      md5: 3e5aeda51b77d3e772fb7da6f83303eb
      size: 38605
    - path: preprocessors/column_transformer.pkl
      hash: md5
      md5: 2bcecd274545ae9806aa880dea56a2a3
      size: 4557674
    - path: preprocessors/feature_names.json
      hash: md5
      md5: 7b36b5b1f14b69b2d1ba8055ceb38a20
      size: 1370
  preprocess_stockcode:
    cmd: "python src/data_handling/preprocess.py --target_col quantity --should_scale
      true --verbose false --stockcode 85123A\n"
    deps:
    - path: src/_utils
      hash: md5
      md5: ae41392532188d290395495f6827ed00.dir
      size: 15870
      nfiles: 10
    - path: src/data_handling/
      hash: md5
      md5: 27dec72cc84da0ff6ff5b45bc9d9a86c.dir
      size: 95629
      nfiles: 30
    - path: src/data_handling/preprocess.py
      hash: md5
      md5: 92c0850d9e030c3c7313fec8e0a1a550
      size: 6849
    params:
      params.yaml:
        params.should_scale: true
        params.stockcode: 85123A
        params.target_col: quantity
        params.verbose: false
    outs:
    - path: data/x_test_df_85123A.parquet
      hash: md5
      md5: d0a9cbd556fa1357e04947766e2abe5e
      size: 18839
    - path: data/x_test_processed_85123A.parquet
      hash: md5
      md5: 92886388997be40034db3e9a54eaedc5
      size: 41119
    - path: data/x_train_df_85123A.parquet
      hash: md5
      md5: 30b486161a437c872ae1c00f5098c36e
      size: 35665
    - path: data/x_train_processed_85123A.parquet
      hash: md5
      md5: a2fe8859c47e4e6f52927b93fcd62dd8
      size: 54603
    - path: data/x_val_df_85123A.parquet
      hash: md5
      md5: a8d90b5afce282ad9ff809238018582b
      size: 19175
    - path: data/x_val_processed_85123A.parquet
      hash: md5
      md5: f25aae161647d9deab4669a22c75269a
      size: 41358
    - path: data/y_test_df_85123A.parquet
      hash: md5
      md5: 23895f05c81ec835c76a4999e4e2f621
      size: 1704
    - path: data/y_train_df_85123A.parquet
      hash: md5
      md5: 501588641d7036637dffedc6ade2f0c4
      size: 2595
    - path: data/y_val_df_85123A.parquet
      hash: md5
      md5: aa5b9af629d06b0d61dd5bd5fa6b04f7
      size: 1630
    - path: metrics/data_85123A.json
      hash: md5
      md5: cebe4b7e165b0f6719c411f298d2e13f
      size: 780
  tune_primary_model:
    cmd: "python src/model/torch_model/main.py data/x_train_processed_85123A.parquet
      data/x_val_processed_85123A.parquet data/y_train_df_85123A.parquet data/y_val_df_85123A.parquet
      false false 100 3000 85123A\n"
    deps:
    - path: src/_utils/
      hash: md5
      md5: ae41392532188d290395495f6827ed00.dir
      size: 15870
      nfiles: 10
    - path: src/data_handling/
      hash: md5
      md5: 27dec72cc84da0ff6ff5b45bc9d9a86c.dir
      size: 95629
      nfiles: 30
    - path: src/model/
      hash: md5
      md5: 4ff2bd4ed2767dbe1724957d4eab550d.dir
      size: 198010
      nfiles: 59
    - path: src/model/torch_model/main.py
      hash: md5
      md5: 799254011ebe2eb61583894b10a3a2cf
      size: 5280
    params:
      params.yaml:
        params.stockcode: 85123A
        tuning.grid: false
        tuning.n_trials: 100
        tuning.should_local_save: false
    outs:
    - path: metrics/dfn_val_85123A.json
      hash: md5
      md5: 5c8b6f89c85c0119b2333ae6b4ccc839
      size: 1507
    - path: models/production/dfn_best_85123A.pth
      hash: md5
      md5: bddd97512f9c57ce051daa8b5510f3b9
      size: 4646495
  inference_primary_model:
    cmd: "python src/model/torch_model/inference.py data/x_test_processed_85123A.parquet
      data/y_test_df_85123A.parquet models/production/dfn_best_85123A.pth 85123A is_registered
      1\n"
    deps:
    - path: models/production/
      hash: md5
      md5: e1a27f841723d62685bd1f394529a4c3.dir
      size: 4646516
      nfiles: 2
    - path: src/_utils/
      hash: md5
      md5: ae41392532188d290395495f6827ed00.dir
      size: 15870
      nfiles: 10
    - path: src/model/
      hash: md5
      md5: 4ff2bd4ed2767dbe1724957d4eab550d.dir
      size: 198010
      nfiles: 59
    - path: src/model/torch_model/inference.py
      hash: md5
      md5: a158052f542d1c1e2cf95bb9bdeb5168
      size: 5243
    params:
      params.yaml:
        params.stockcode: 85123A
        tracking.privileged_group: 1
        tracking.sensitive_feature_col: is_registered
    outs:
    - path: data/dfn_inference_results_85123A.parquet
      hash: md5
      md5: b824f75453d56668dbefa4db909b4097
      size: 2653
    - path: metrics/dfn_inf_85123A.json
      hash: md5
      md5: b6e76892f5da27174866660d4a0880f9
      size: 1507
    - path: reports/dfn_raw_shap_values_85123A.parquet
      hash: md5
      md5: d6adcd881881548c4e91cabdb3cb6d6b
      size: 169592
    - path: reports/dfn_shap_mean_abs_85123A.json
      hash: md5
      md5: 12a6239a7be6c7874ce9b05e72373ba6
      size: 5914
    - path: reports/dfn_shap_summary_85123A.json
      hash: md5
      md5: c637d99af90c8b145ac8c38fc287d0ed
      size: 3479079
  assess_model_risk:
    cmd: "python src/model/torch_model/assess_risk_and_fairness.py data/dfn_inference_results_85123A.parquet
      metrics/dfn_risk_fairness_85123A.json is_registered 85123A 1 0.1\n"
    deps:
    - path: data/dfn_inference_results_85123A.parquet
      hash: md5
      md5: b824f75453d56668dbefa4db909b4097
      size: 2653
    - path: src/_utils/
      hash: md5
      md5: ae41392532188d290395495f6827ed00.dir
      size: 15870
      nfiles: 10
    - path: src/model/torch_model/assess_risk_and_fairness.py
      hash: md5
      md5: e77a9c96999e1265af199530bfdcc5d0
      size: 4426
    params:
      params.yaml:
        params.stockcode: 85123A
        tracking.mod_threshold: 0.1
        tracking.privileged_group: 1
        tracking.sensitive_feature_col: is_registered
    outs:
    - path: metrics/dfn_risk_fairness_85123A.json
      hash: md5
      md5: 692dbad01f38bd69986fefe476096bb9
      size: 515
