schema: '2.0'
stages:
  etl_pipeline_full:
    cmd: python src/data_handling/etl_pipeline.py
    deps:
    - path: src/_utils/
      hash: md5
      md5: ae41392532188d290395495f6827ed00.dir
      size: 15870
      nfiles: 10
    - path: src/data_handling/
      hash: md5
      md5: 3ff202fc8725e7b29c22c8f56cafa82f.dir
      size: 95686
      nfiles: 30
    - path: src/data_handling/etl_pipeline.py
      hash: md5
      md5: e35381b28eb69484e9eb78512f125f2f
      size: 1817
    outs:
    - path: data/original_df.parquet
      hash: md5
      md5: a9edc0b0bcdd43647f07092715bf7c24
      size: 3628798
    - path: data/processed_df.parquet
      hash: md5
      md5: 96cf10e6f6375c1449384cc70ffc303a
      size: 7019782
  etl_pipeline_stockcode:
    cmd: python src/data_handling/etl_pipeline.py --stockcode 85123A
    deps:
    - path: src/_utils/
      hash: md5
      md5: ae41392532188d290395495f6827ed00.dir
      size: 15870
      nfiles: 10
    - path: src/data_handling/
      hash: md5
      md5: 3ff202fc8725e7b29c22c8f56cafa82f.dir
      size: 95686
      nfiles: 30
    - path: src/data_handling/etl_pipeline.py
      hash: md5
      md5: e35381b28eb69484e9eb78512f125f2f
      size: 1817
    params:
      params.yaml:
        params.stockcode: 85123A
    outs:
    - path: data/processed_df_85123A.parquet
      hash: md5
      md5: cedb58bc1fc056755e76b5fc34ec6bd4
      size: 54966
  data_drift_check:
    cmd: "python src/data_handling/report_data_drift.py data/processed/processed_df.csv
      data/processed_df_85123A.parquet reports/data_drift_report_85123A.html metrics/data_drift_85123A.json
      85123A\n"
    deps:
    - path: src/_utils/
      hash: md5
      md5: ae41392532188d290395495f6827ed00.dir
      size: 15870
      nfiles: 10
    - path: src/data_handling/report_data_drift.py
      hash: md5
      md5: 16b2c1a87b4550da1927f23d91cc5331
      size: 3001
    - path: src/data_handling/scripts/
      hash: md5
      md5: d9c8cf22f7f53ebff966b530a56d77ea.dir
      size: 50857
      nfiles: 16
    params:
      params.yaml:
        params.stockcode: 85123A
    outs:
    - path: metrics/data_drift_85123A.json
      hash: md5
      md5: 66dfaaba2abfc34a3eef3c804eb953fb
      size: 606
    - path: reports/data_drift_report_85123A.html
      hash: md5
      md5: 13205e2f0896a2fcd19b40aeb97dba5d
      size: 4557812
  preprocess_full:
    cmd: "python src/data_handling/preprocess.py --target_col quantity --should_scale
      true --verbose false\n"
    deps:
    - path: src/_utils
      hash: md5
      md5: ae41392532188d290395495f6827ed00.dir
      size: 15870
      nfiles: 10
    - path: src/data_handling/
      hash: md5
      md5: 3ff202fc8725e7b29c22c8f56cafa82f.dir
      size: 95686
      nfiles: 30
    - path: src/data_handling/preprocess.py
      hash: md5
      md5: 92c0850d9e030c3c7313fec8e0a1a550
      size: 6849
    params:
      params.yaml:
        params.should_scale: true
        params.target_col: quantity
        params.verbose: false
    outs:
    - path: data/x_test_df.parquet
      hash: md5
      md5: b433d5d013e0824908ae8ba0be9736f1
      size: 638272
    - path: data/x_test_processed.parquet
      hash: md5
      md5: dcee91f33645f172644534fdc11dff77
      size: 655361
    - path: data/x_train_df.parquet
      hash: md5
      md5: 8f74a63778d46ebd119e4e9558b32956
      size: 5312507
    - path: data/x_train_processed.parquet
      hash: md5
      md5: 1ae1ece5d3041181428b0399975bad4e
      size: 5403755
    - path: data/x_val_df.parquet
      hash: md5
      md5: c1fdd47191bcafd6d882d67d17761087
      size: 589368
    - path: data/x_val_processed.parquet
      hash: md5
      md5: b575c31b8795e0483684d6678f9aec9a
      size: 605827
    - path: data/y_test_df.parquet
      hash: md5
      md5: b4569386ace6996849d4d72fd6e5103a
      size: 37845
    - path: data/y_train_df.parquet
      hash: md5
      md5: 5ab80240303ac52191186e504e4dd026
      size: 380269
    - path: data/y_val_df.parquet
      hash: md5
      md5: b7a462bfa43677b5a8f370881729a109
      size: 38605
    - path: preprocessors/column_transformer.pkl
      hash: md5
      md5: 2bcecd274545ae9806aa880dea56a2a3
      size: 4557674
    - path: preprocessors/feature_names.json
      hash: md5
      md5: 7b36b5b1f14b69b2d1ba8055ceb38a20
      size: 1370
  preprocess_stockcode:
    cmd: "python src/data_handling/preprocess.py --target_col quantity --should_scale
      true --verbose false --stockcode 85123A\n"
    deps:
    - path: src/_utils
      hash: md5
      md5: ae41392532188d290395495f6827ed00.dir
      size: 15870
      nfiles: 10
    - path: src/data_handling/
      hash: md5
      md5: 3ff202fc8725e7b29c22c8f56cafa82f.dir
      size: 95686
      nfiles: 30
    - path: src/data_handling/preprocess.py
      hash: md5
      md5: 92c0850d9e030c3c7313fec8e0a1a550
      size: 6849
    params:
      params.yaml:
        params.should_scale: true
        params.stockcode: 85123A
        params.target_col: quantity
        params.verbose: false
    outs:
    - path: data/x_test_df_85123A.parquet
      hash: md5
      md5: b5c67ae9453fd2fb55819735966bc514
      size: 18839
    - path: data/x_test_processed_85123A.parquet
      hash: md5
      md5: f6c49afed7126756c5f1729ee6b7ebe9
      size: 41119
    - path: data/x_train_df_85123A.parquet
      hash: md5
      md5: 965cad61e6d21d51cd90dcf3a8a26b6f
      size: 35665
    - path: data/x_train_processed_85123A.parquet
      hash: md5
      md5: ec60a69bdcffc489579a7b3061b42f7e
      size: 54603
    - path: data/x_val_df_85123A.parquet
      hash: md5
      md5: 180371bbb032779bd7750c054f721311
      size: 19175
    - path: data/x_val_processed_85123A.parquet
      hash: md5
      md5: 0eac891a310d10cbb22a4bc55f755263
      size: 41358
    - path: data/y_test_df_85123A.parquet
      hash: md5
      md5: db8cc595ccbb81f88b507f105dfd24fa
      size: 1704
    - path: data/y_train_df_85123A.parquet
      hash: md5
      md5: ea3290566241b93b800f05a20ee66894
      size: 2595
    - path: data/y_val_df_85123A.parquet
      hash: md5
      md5: 0a6bca00e70ccd826e7aa2b79a88a3bf
      size: 1630
    - path: metrics/data_85123A.json
      hash: md5
      md5: 0542fbd872ae09834675b3ddba5a271c
      size: 780
  tune_primary_model:
    cmd: "python src/model/torch_model/main.py data/x_train_processed_85123A.parquet
      data/x_val_processed_85123A.parquet data/y_train_df_85123A.parquet data/y_val_df_85123A.parquet
      false false 100 3000 85123A\n"
    deps:
    - path: src/_utils/
      hash: md5
      md5: ae41392532188d290395495f6827ed00.dir
      size: 15870
      nfiles: 10
    - path: src/data_handling/
      hash: md5
      md5: 3ff202fc8725e7b29c22c8f56cafa82f.dir
      size: 95686
      nfiles: 30
    - path: src/model/
      hash: md5
      md5: 8b32c64545d94d0bdb132ee25fea1fcd.dir
      size: 193021
      nfiles: 57
    - path: src/model/torch_model/main.py
      hash: md5
      md5: 799254011ebe2eb61583894b10a3a2cf
      size: 5280
    params:
      params.yaml:
        params.stockcode: 85123A
        tuning.grid: false
        tuning.n_trials: 100
        tuning.should_local_save: false
    outs:
    - path: metrics/dfn_val_85123A.json
      hash: md5
      md5: c416f8758b0c4cfb95998ce0e2f1596a
      size: 1164
    - path: models/production/dfn_best_85123A.pth
      hash: md5
      md5: e5ed198a63bfb1a837a3c8c02497302c
      size: 1460539
  inference_primary_model:
    cmd: "python src/model/torch_model/inference.py data/x_test_processed_85123A.parquet
      data/y_test_df_85123A.parquet models/production/dfn_best_85123A.pth 85123A is_registered
      1\n"
    deps:
    - path: models/production/
      hash: md5
      md5: 45cc10359dd4634b47b77a08e547a543.dir
      size: 1460560
      nfiles: 2
    - path: src/_utils/
      hash: md5
      md5: ae41392532188d290395495f6827ed00.dir
      size: 15870
      nfiles: 10
    - path: src/model/
      hash: md5
      md5: 8b32c64545d94d0bdb132ee25fea1fcd.dir
      size: 193021
      nfiles: 57
    - path: src/model/torch_model/inference.py
      hash: md5
      md5: a158052f542d1c1e2cf95bb9bdeb5168
      size: 5243
    params:
      params.yaml:
        params.stockcode: 85123A
        tracking.privileged_group: 1
        tracking.sensitive_feature_col: is_registered
    outs:
    - path: data/dfn_inference_results_85123A.parquet
      hash: md5
      md5: 16efa84e2a6cd37d901c36f33e60c4a2
      size: 2653
    - path: metrics/dfn_inf_85123A.json
      hash: md5
      md5: be16c6b61cfa967619137b04e3d24293
      size: 1164
    - path: reports/dfn_raw_shap_values_85123A.parquet
      hash: md5
      md5: 92f9121d4cc985975ec11612d4111643
      size: 181094
    - path: reports/dfn_shap_mean_abs_85123A.json
      hash: md5
      md5: 4556111b2f02409695be1c991871d187
      size: 5913
    - path: reports/dfn_shap_summary_85123A.json
      hash: md5
      md5: 4e3534f6a7f4fbcaca51ac021f563b7f
      size: 3494973
  assess_model_risk:
    cmd: "python src/model/torch_model/assess_risk_and_fairness.py data/dfn_inference_results_85123A.parquet
      metrics/dfn_risk_fairness_85123A.json is_registered 85123A 1 0.1\n"
    deps:
    - path: data/dfn_inference_results_85123A.parquet
      hash: md5
      md5: 16efa84e2a6cd37d901c36f33e60c4a2
      size: 2653
    - path: src/_utils/
      hash: md5
      md5: ae41392532188d290395495f6827ed00.dir
      size: 15870
      nfiles: 10
    - path: src/model/torch_model/assess_risk_and_fairness.py
      hash: md5
      md5: e77a9c96999e1265af199530bfdcc5d0
      size: 4426
    params:
      params.yaml:
        params.stockcode: 85123A
        tracking.mod_threshold: 0.1
        tracking.privileged_group: 1
        tracking.sensitive_feature_col: is_registered
    outs:
    - path: metrics/dfn_risk_fairness_85123A.json
      hash: md5
      md5: 176d0f6f6db88995cd21da73b8c2ef09
      size: 518
